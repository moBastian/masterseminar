<%
  question = item.itemtext.split("{")[0]
  alternatives = item.itemtext.split("{")[1].split("}")[0].split(",")
%>
<% if  @student.group_type == 3%>
<div class="row">
  <% count = 0%>
  <% keys = @student.achievement.keys %>
  <%while count<@student.achievement.size%>
      <% achievementInfos = @student.achievement[keys[count]]%>
      <% puts achievementInfos%>
      <% if(! achievementInfos[0])%>
          <div class="col-lg-1" >
            <img src=<%= achievementInfos[1]%> width="60px" >
          </div>
      <% else %>
          <div class="col-lg-1" >
            <img src=<%= achievementInfos[2]%> width="60px" >
          </div>
      <% end%>
      <% count = count +1%>
      <% if(count == 8)%>
          </div>
          <br/>
          <div class="row">
      <%end%>
  <%end%>
  </div>
<% end%>

<div class="row" style="margin-right: 15px">
  <button style='font-family: fibel_nordregular; float: right; font-size:40px' id="closeTest" class="btn btn-warning" onclick="interruptMeasurement()"><strong>Test beenden</strong></button>
</div>
<br/>
<br/>
<div class='row text-center'>
  <div>
    <label class='control-label' style='font-size: 60px; font-family: fibel_nordregular;'><%= question %>&nbsp</label>
  </div>
</div>
<br><br>
<div class='row' id='rowButtons2' >
  <div class="col-lg-7 col-md-offset-3">
    <div class='col-lg-4 col-lg-offset-0' >
      <div class ='row'>
        <button id='button0' style='font-size: 60px; font-family: fibel_nordregular;' type='button' class='btn btn-default btn-block' onclick="nextClicked('<%= alternatives[0] %>','#button0')"><%= alternatives[0] %></button>
      </div>
    </div>
    <div class='col-lg-4 col-lg-offset-2' >
      <div class ='row'>
        <button id='button1' style='font-size: 60px; font-family: fibel_nordregular;' type='button' class='btn btn-default btn-block' onclick="nextClicked('<%= alternatives[1] %>', '#button1')"><%= alternatives[1] %></button>
      </div>
    </div>
  </div>
</div>
<br/>
<div class='row' id='rowButtons2' >
  <div class="col-lg-7 col-md-offset-3">
    <div class='col-lg-4 col-lg-offset-0' >
      <div class ='row'>
        <button id='button2' style='font-size: 60px; font-family: fibel_nordregular;' type='button' class='btn btn-default btn-block' onclick="nextClicked('<%= alternatives[2] %>', '#button2')"><%= alternatives[2] %></button>
      </div>
    </div>
    <div class='col-lg-4 col-lg-offset-2' >
      <div class ='row'>
        <button id='button3' style='font-size: 60px; font-family: fibel_nordregular;' type='button' class='btn btn-default btn-block' onclick="nextClicked('<%= alternatives[3] %>', '#button3')"><%= alternatives[3] %></button>
      </div>
    </div>
  </div>
</div>
<br/>
<div class='row' id='rowButtons3' >
  <div class="col-lg-7 col-md-offset-3">
    <div class='col-lg-3 col-lg-offset-0' >
    </div>
    <div class='col-lg-4 col-lg-offset-0' >
      <div class ='row'>
        <button id='buttonCon' style='font-size: 60px; font-family: fibel_nordregular; visibility: hidden' type='button' class='btn btn-info btn-block' onclick="nextItem()">Nächste Frage</button>
      </div>
    </div>
    <div class='col-lg-3 col-lg-offset-2' >
    </div>
  </div>
</div>
<br/>
<br/>
<br/>


<script>
  var toggle = false;
  function nextClicked(answer, buttonId) {
      toggle = true;
      $('#button0').prop('onclick',null).off('click');
      $('#button1').prop('onclick',null).off('click');
      $('#button2').prop('onclick',null).off('click');
      $('#button3').prop('onclick',null).off('click');
      if(answer=='<%= item.shorthand%>'){
          score = score +1;
          currentResult = currentResult + '1,';
          $(buttonId).removeClass('btn-default');
          $(buttonId).addClass('btn-success');
      }
      else {
          currentResult = currentResult + '0,';
          $(buttonId).removeClass('btn-default');
          $(buttonId).addClass('btn-danger');
          if($('#button0').html() == '<%= item.shorthand%>') {
              $('#button0').removeClass('btn-default');
              $('#button0').addClass('btn-success');
          }
          else if($('#button1').html() == '<%= item.shorthand%>'){
              $('#button1').removeClass('btn-default');
              $('#button1').addClass('btn-success');
          }
          else if($('#button2').html() == '<%= item.shorthand%>'){
              $('#button2').removeClass('btn-default');
              $('#button2').addClass('btn-success');
          }
          else{
              $('#button3').removeClass('btn-default');
              $('#button3').addClass('btn-success');
          }
      };
      currentTimes = currentTimes + (new Date() - stopwatch) + ',';
      stopwatch = new Date();
      $('#buttonCon').css('visibility', 'visible');
  };

  function interruptMeasurement () {
      if(!toggle){
          currentResult = currentResult + '0,';
      }
      stopTest();
      $(window).unbind('keyup');
  }
  //F5 abschalten <- kein aktualisieren möglich
  $(window).keydown(function (event) {
      var key = event.charCode || event.keyCode;
      if (key == 116) {
          event.preventDefault();
      }});


  switch (testName) {
      case "Tiere&Pflanzen-Test":
          if(achievementHash["a8"][0]!= "true") {
              check50("a8");
              checkAll();
          }
          break;
      case "Geographietest":
          if(achievementHash["a9"][0]!= "true") {
              check50("a9");
              checkAll();
          }
          break;
      case "Geschichtstest":
          break;
      case "Mathetest":
          if(achievementHash["a10"][0]!= "true") {
              check50("a10");
              checkAll();
          }
          break;
      case "Sporttest":
          if(achievementHash["a11"][0]!= "true") {
              check50("a11");
              checkAll();
          }
          break;
      case "Politiktest":
          if(achievementHash["a12"][0]!= "true") {
              check50("a12");
              checkAll();
          }
          break;
      default:
          if(achievementHash["a13"][0]!= "true") {
              check50("a13");
              checkAll();

          }
          break;
  }

  function checkAll() {
      if(achievementHash["a8"][0]== "true"&&achievementHash["a9"][0]== "true"&&achievementHash["a10"][0]== "true"
          &&achievementHash["a11"][0]== "true"&&achievementHash["a12"][0]== "true"&&achievementHash["a13"][0]== "true"){
          alert("Sie haben ein Abzeichen bekommen: Alles Testrelevaten Abzeichen erhalten")
          achievementHash["a14"][0] = "true";

          var test = {"student": {"achievement": achievementHash}};
          $.ajax({
              method: 'PUT',
              url: "<%= user_group_student_path(@student.group.user, @student.group, @student)%>",
              data: test,
          });
      }
  }

  function check50(key) {
      var currentItemtext = "<%= raw item.itemtext%>";
      var toggle2 = true;
      for(i=0; i<oldItems.length;i++){
          if(currentItemtext==oldItems[i]){
              toggle2 = false;
          }
      }

      if(toggle2){
          oldItems.push(currentItemtext)
      }

      if(oldItems.length == 50){
          alert("Sie haben ein neues abzeichen bekommen: 50%& der Fragen gesehen.")
          achievementHash[key][0] = "true";

          var test = {"student": {"achievement": achievementHash}};
          $.ajax({
              method: 'PUT',
              url: "<%= user_group_student_path(@student.group.user, @student.group, @student)%>",
              data: test,
          });
      }
  }


</script>